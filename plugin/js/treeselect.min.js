jQuery.fn.treeSelect=function(e){var t=this,l=0,s=$(this).attr("id"),r=$(t).data(),c=[],n={multiple:!1,parentNodeRelative:!0,source:{},parensSelectable:!1};$.each(e,function(t,l){t in n||delete e[t]}),$.each(r,function(t,l){t in n||delete r[t],e[t]=l});var a=$.extend({},n,e),i=function(e){var t="<ul "+(1===++l?'class="treeselect-ul treeselect-hide"':"")+">";return $.each(e,function(e,s){o(s);var r="children"in s,c="";r?(c+="treeselect-haschildren",a.parensSelectable&&(c+=" treeselect-hover treeselect-selectable")):c+="treeselect-hasnotchildren treeselect-hover treeselect-selectable",t+="<li data-value='"+s.id+"' class='"+c+" level-"+l+"' >"+s.name+"</li>",r&&(t+="<li>"+i(s.children)+"</li>")}),t+="</ul>",l=l>1?l-1:1,t},o=function(e){"object"!=typeof e&&console.log("TreeSelect error: It is not an object"),"id"in e||console.log("TreeSelect error: Missing id from source!"),"name"in e||console.log("TreeSelect error: Missing name from source!")},u=function(){t.next("ul.treeselect-ul").hasClass("treeselect-show")&&$(t).next("ul.treeselect-ul").removeClass("treeselect-show").addClass("treeselect-hide")};$(i(a.source)).insertAfter(t),a.parentNodeRelative&&$(t).parent().css({position:"relative"}),$(t).click(function(){$(this).next("ul.treeselect-ul").hasClass("treeselect-hide")?$(this).next("ul.treeselect-ul").removeClass("treeselect-hide").addClass("treeselect-show"):$(this).next("ul.treeselect-ul").removeClass("treeselect-show").addClass("treeselect-hide")}),$("ul.treeselect-ul").on("click","li.treeselect-selectable",function(){var e=$(this).data("value");return a.multiple?c.push(e):(a.parensSelectable||$(this).hasClass("treeselect-hasnotchildren"))&&($(t).val(e),$(t).next("ul.treeselect-ul").find("li.treeselect-selected").removeClass("treeselect-selected")),$(this).addClass("treeselect-selected"),u(),!1}),$(document).click(function(e){$(e.target).closest("ul.treeselect-ul").length||$(e.target).attr("id")===s||u()})};